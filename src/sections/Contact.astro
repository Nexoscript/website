---

---

<section
  id="contact"
  class="relative w-full flex flex-col bg-(--background) text-(--text) overflow-hidden"
>
  <p class="p-8 text-3xl font-semibold">Contact</p>

  <!-- BACKGROUND BLUR (behind everything) -->
  <div class="pointer-events-none absolute inset-0 -z-10">
    <div
      class="absolute -inset-32 bg-gradient-to-br from-(--primary)/15 via-transparent to-(--accent)/15 blur-3xl opacity-80"
    >
    </div>
  </div>

  <!-- FORM (dimmed & disabled while WIP) -->
  <form
    id="contact-form"
    class="relative p-6 flex flex-col gap-4 bg-(--background-light)/80 border border-(--background-lightest) rounded-lg backdrop-blur-md opacity-60 pointer-events-none"
    aria-disabled="true"
  >
    <div class="w-full flex gap-4">
      <input
        name="name"
        required
        placeholder="Name"
        class="flex-1 rounded-lg bg-(--background-lighter) px-4 py-3"
      />
      <input
        name="email"
        type="email"
        required
        placeholder="Email"
        class="flex-1 rounded-lg bg-(--background-lighter) px-4 py-3"
      />
    </div>
    <textarea
      name="message"
      required
      rows="5"
      placeholder="Message"
      class="rounded-xl bg-(--background-lighter) px-4 py-3 resize-none"
    ></textarea>
    <div id="turnstile-widget" class="min-h-[65px]"></div>
    <button
      type="submit"
      disabled
      class="mt-2 rounded-xl bg-(--primary) px-6 py-3 font-semibold text-black opacity-60 cursor-not-allowed"
    >
      Send message
    </button>
    <p id="form-message" class="text-sm hidden"></p>
  </form>

  <!-- CENTER LOCK + WIP BADGE -->
  <div
    class="pointer-events-none absolute inset-0 flex items-center justify-center"
  >
    <div
      class="flex flex-col items-center gap-3 rounded-2xl bg-black/60 px-6 py-4 border border-white/10 shadow-lg"
    >
      <div
        class="flex items-center justify-center h-12 w-12 rounded-full bg-(--background-lighter)/70 border border-white/10"
      >
        <span class="text-2xl">ðŸ”’</span>
      </div>
      <div class="flex items-center gap-2">
        <span
          class="text-xs font-semibold tracking-[0.18em] uppercase text-white/70"
        >
          Work in progress
        </span>
        <span
          class="px-2 py-0.5 rounded-full text-[10px] font-semibold uppercase tracking-wide bg-(--accent)/20 text-(--accent) border border-(--accent)/40"
        >
          WIP
        </span>
      </div>
      <p class="text-xs text-white/60 text-center max-w-xs">
        This contact form is not available yet. Check back soon.
      </p>
    </div>
  </div>
</section>

<script>
  let turnstileLoaded = false;
  let widgetId = null;

  const script = document.createElement("script");
  script.src =
    "https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit";
  script.async = true;
  script.defer = true;
  script.onload = () => {
    turnstileLoaded = true;
    renderTurnstile();
  };
  document.head.appendChild(script);

  function renderTurnstile() {
    if (!turnstileLoaded || !window.turnstile) {
      setTimeout(renderTurnstile, 100);
      return;
    }

    try {
      const container = document.getElementById("turnstile-widget");
      if (container && !widgetId) {
        widgetId = window.turnstile.render("#turnstile-widget", {
          sitekey: "0x4AAAAAACJLRahSOte2nhUO",
          theme: "dark",
          size: "normal",
          callback: function (token) {
            console.log("Turnstile verified:", token);
          },
          "error-callback": function () {
            console.error("Turnstile error");
            showMessage(
              "Verification failed. Please refresh the page.",
              "error"
            );
          },
          "expired-callback": function () {
            console.log("Turnstile expired");
          },
        });
      }
    } catch (error) {
      console.error("Failed to render Turnstile:", error);
      showMessage(
        "Could not load verification. Please refresh the page.",
        "error"
      );
    }
  }

  function initForm() {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const submitBtn = form?.querySelector(
      'button[type="submit"]'
    ) as HTMLButtonElement;

    if (!form) return;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const token = window.turnstile?.getResponse(widgetId);

      if (!token) {
        showMessage("Please complete the verification", "error");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Sending...";

      try {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        const response = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ...data, token }),
        });

        if (response.ok) {
          form.reset();
          if (window.turnstile && widgetId) {
            window.turnstile.reset(widgetId);
          }
          showMessage("Message sent successfully!", "success");
        } else {
          const errorData = await response.json().catch(() => ({}));
          showMessage(
            errorData.error || "Failed to send message. Please try again.",
            "error"
          );
        }
      } catch (error) {
        console.error("Form submission error:", error);
        showMessage("An error occurred. Please try again.", "error");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Send message";
      }
    });
  }

  function showMessage(text: string, type: string) {
    const messageEl = document.getElementById("form-message");
    if (messageEl) {
      messageEl.textContent = text;
      messageEl.className = `text-sm ${
        type === "success" ? "text-green-500" : "text-red-500"
      }`;
      messageEl.classList.remove("hidden");
      setTimeout(() => messageEl.classList.add("hidden"), 5000);
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      initForm();
      renderTurnstile();
    });
  } else {
    initForm();
    renderTurnstile();
  }
</script>
